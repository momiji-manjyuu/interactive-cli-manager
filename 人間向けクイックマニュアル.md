# 対話型CLIマネージャー（人間向けクイックマニュアル）

このスクリプト（`interactive_cli_manager.py`）は、AIやスクリプトからWindows上のCLIツールを安全かつ確実に操作する「仲介役（ブリッジ）」です。JSONで指示を出すと、コマンド実行・入力送信・出力取得・状態監視・停止などを代わりに行います。

## 用途のイメージ
- 対話型CLI（インストーラー、REPL、対話ユーティリティ）の自動操作
- 通常のコマンドの逐次実行、ログ取得、エラーハンドリング
- 隔離環境のAIから、共有ディレクトリ経由でWindowsのCLIを制御（FSブリッジ）

## 起動モード（2種類）
- 通常モード（STDIN/STDOUT直結）
  - 実行: `python interactive_cli_manager.py`
  - 特徴: 最低レイテンシ。1行1JSONで指示（人手で直接使うより、スクリプト/ツールから使う想定）
- FSブリッジモード（ファイル経由）
  - 実行: `python interactive_cli_manager.py --fs-bridge`（デフォルトで`./fs_bridge`を使用）
    - 相対パス例: `python interactive_cli_manager.py --fs-bridge fs_bridge`
    - 明示: `python interactive_cli_manager.py --fs-bridge C:\\Users\\User\\Codex_CLI\\fs_bridge`
  - 特徴: `fs_bridge/in`にリクエスト（1行1JSON）を書き込むと、同名のレスポンスが`fs_bridge/out`に返る。ネットワーク不要。
  - ポーリング間隔: `--fs-interval 0.05`（秒）で調整可

### どちらを使うべき？（重要）
- ローカルLLM/同一マシンのスクリプトが使う場合: 基本は「通常モード」。必要に応じてFSブリッジを起動。
- サンドボックス/隔離環境のAIが使う場合: 「FSブリッジモード」のみ可。ユーザー（あなた）がFSブリッジを起動する必要があります。
- FSブリッジの起動確認（AI側）: `fs_bridge/in`に疎通リクエスト（例: `{ "action":"get_status" }`）を書き込み、`fs_bridge/out`に同名レスポンスが来るかを待つ方法で検出可能です（または人が「起動OK」と伝える運用）。

## よく使う起動オプション
- `--fs-bridge [パス]`
  - 指定するとFSブリッジモードで起動。値を省略すると`./fs_bridge`を使用。
- `--fs-interval <秒>`
  - FSブリッジのポーリング間隔（秒）。既定は0.05（=50ms）。

## 使い分けの目安
- 通常モード: ローカルLLMや同一マシンのスクリプトから直接制御する場合
- FSブリッジ: 隔離環境のAIから、共有フォルダで間接制御する場合（本PCでマネージャーを起動して待ち受ける）

## 注意点（かんたん）
- 1行1JSONルール: 実際の投入時は必ず1行に詰める
- シェル機能（`|`, `>`）は`--shell true`相当で文字列コマンドとして渡す（内部の`data.shell:true`）
- バックグラウンド実行: 推奨は「マネージャー本体」のみ。対話対象CLIは前景で起動しAPIで制御
- 文字化け対策: 可能ならUTF-8統一（`chcp 65001`/PowerShellの`OutputEncoding`/`set_encoding`）
- TUI（画面制御系）は現時点で凍結（`tui:true`は未対応）

## ファイル構成（最小で使うなら）
- 本体: `interactive_cli_manager.py`（通常モード／FSブリッジ両対応）
- FSブリッジ最小クライアント: `fs_send.py`（1リクエスト→1レスポンス）
- 参考（任意）: `fs_client.py`（複数ステップのデモ／検証用。なくても可）

---
このクイックマニュアルは、人がサッと使うための要点のみをまとめています。詳細は同梱の「対話型CLIマネージャー AI用マニュアル.md」を参照してください。
